<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IBAN Shield - Demo</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    :root{
      --bg1:#0b1220;
      --bg2:#111b2f;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#6b7280;
      --primary:#2563eb;
      --primary2:#1e40af;
      --border:#e5e7eb;

      --okBg:#d1fae5;
      --okText:#065f46;

      --warnBg:#fef3c7;
      --warnText:#92400e;

      --errBg:#fee2e2;
      --errText:#991b1b;
    }

    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1000px 500px at 20% 10%, rgba(37,99,235,.28), transparent 60%),
                  radial-gradient(900px 600px at 90% 30%, rgba(16,185,129,.14), transparent 60%),
                  linear-gradient(135deg,var(--bg1),var(--bg2));
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    .card{
      width:min(520px, 92vw);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.35);
      border-radius:22px;
      box-shadow: 0 25px 70px rgba(0,0,0,.45);
      padding:26px 26px 22px;
    }

    .brandRow{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:14px;
      margin-bottom:18px;
    }

    .brandLogo{
      width:56px;
      height:56px;
      border-radius:16px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(37,99,235,.10);
      border:1px solid rgba(37,99,235,.18);
    }

    .brandText .top{
      font-weight:900;
      font-size:26px;
      color:var(--text);
    }

    .brandText .sub{
      font-weight:800;
      font-size:18px;
      color:var(--primary);
    }

    .tagline{
      text-align:center;
      color:var(--muted);
      font-size:12.5px;
      margin-bottom:18px;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-bottom:12px;
    }

    label{
      font-size:12px;
      color:#374151;
      font-weight:700;
    }

    input{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--border);
      font-size:14.5px;
    }

    .btn{
      width:100%;
      padding:13px;
      border:none;
      border-radius:14px;
      background: linear-gradient(180deg, var(--primary), var(--primary2));
      color:white;
      font-weight:900;
      font-size:15px;
      cursor:pointer;
      margin-top:6px;
    }

    .btn.secondary{ display:none; background:#0f172a; }
    .btn.pay{ display:none; background:#16a34a; }

    .result{
      margin-top:14px;
      padding:14px;
      border-radius:14px;
      font-size:14px;
    }

    .success{ background: var(--okBg); color: var(--okText); }
    .warning{ background: var(--warnBg); color: var(--warnText); }
    .error{ background: var(--errBg); color: var(--errText); }

    .score{ margin-top:8px; font-weight:900; }

    #qrTmp{
      position:fixed;
      left:-9999px;
      top:-9999px;
    }
  </style>
</head>

<body>
<div class="card">

  <div class="brandRow">
    <div class="brandLogo">
      <svg width="44" height="44" viewBox="0 0 64 64">
        <defs>
          <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#2563eb"/>
            <stop offset="1" stop-color="#1e40af"/>
          </linearGradient>
        </defs>
        <path d="M32 6 C24 12 16 12 12 12 v18 c0 14 8 23 20 28 c12-5 20-14 20-28 V12 c-4 0-12 0-20-6z" fill="url(#g1)"/>
        <path d="M22 32.5 l6 6 l14-16" fill="none" stroke="#22c55e" stroke-width="6"/>
      </svg>
    </div>
    <div class="brandText">
      <div class="top">IBAN</div>
      <div class="sub">Shield</div>
    </div>
  </div>

  <div class="tagline">Verifica preventiva IBAN + intestatario prima del bonifico.</div>

  <div class="field">
    <label>IBAN</label>
    <input id="iban" />
  </div>

  <div class="field">
    <label>Nome intestatario</label>
    <input id="nome" />
  </div>

  <div class="field">
    <label>Importo (â‚¬)</label>
    <input id="importo" type="number" />
  </div>

  <button class="btn" onclick="verifica()">Verifica Transazione</button>
  <div id="risultato"></div>
  <button id="payBtn" class="btn pay" onclick="paga()">ðŸ’³ Paga & Sblocca</button>
  <button id="pdfBtn" class="btn secondary" onclick="generaPDF()">ðŸ“„ Genera Certificato</button>

</div>

<div id="qrTmp"></div>

<script>
const validIBAN="IT60X0542811101000000123456";
const validName="mario rossi";
let lastData=null;

function verifica(){
  const iban=document.getElementById("iban").value.trim();
  const nome=document.getElementById("nome").value.trim();
  const importo=parseFloat(document.getElementById("importo").value);

  const result=document.getElementById("risultato");
  const payBtn=document.getElementById("payBtn");
  const pdfBtn=document.getElementById("pdfBtn");

  result.innerHTML="";
  payBtn.style.display="none";
  pdfBtn.style.display="none";

  if(!iban||!nome||!importo){ result.innerHTML="âŒ Compila tutti i campi."; result.className="result error"; return;}

  if(iban!==validIBAN){ result.innerHTML="âŒ IBAN non valido (demo)."; result.className="result error"; return;}

  lastData={
    txId:"IS-"+Date.now(),
    iban,nome,importo,
    unlocked:false
  };

  result.innerHTML="ðŸ”’ Verifica disponibile. Completa il pagamento per sbloccare esito ufficiale.";
  result.className="result warning";
  payBtn.style.display="block";
}

function paga(){
  const result=document.getElementById("risultato");
  const pdfBtn=document.getElementById("pdfBtn");

  const match=(lastData.nome.toLowerCase()===validName);
  if(!match){ result.innerHTML="âŒ Intestatario non compatibile."; result.className="result error"; return;}

  let score=95;
  let livello="Elevato livello di sicurezza";

  if(lastData.importo>1000){
    score=82;
    livello="Sicurezza verificata con controllo avanzato";
  }

  lastData.unlocked=true;
  lastData.score=score;
  lastData.livello=livello;

  result.innerHTML=`âœ… Esito ufficiale positivo.<div class="score">Shield Score: ${score}/100</div>`;
  result.className="result success";
  pdfBtn.style.display="block";
}

async function generaPDF(){
  if(!lastData||!lastData.unlocked) return;

  const {jsPDF}=window.jspdf;
  const doc=new jsPDF();

  doc.text("Certificato Ufficiale di Verifica",20,20);
  doc.text("ID Operazione: "+lastData.txId,20,30);
  doc.text("IBAN: "+lastData.iban,20,40);
  doc.text("Intestatario: "+lastData.nome,20,50);
  doc.text("Importo: â‚¬ "+lastData.importo,20,60);
  doc.text("Shield Score: "+lastData.score+"/100",20,70);
  doc.text("Livello Sicurezza: "+lastData.livello,20,80);

  doc.setFontSize(8);
  doc.text("Il presente certificato attesta esclusivamente lâ€™esito della verifica tecnica alla data di emissione.",20,95);
  doc.text("La validitÃ  Ã¨ subordinata alla verifica dello stato online tramite QR.",20,100);

  doc.save("Certificato_IBAN_Shield.pdf");
}
</script>
</body>
</html>