<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IBAN Shield - Demo</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    :root{
      --bg1:#0b1220;
      --bg2:#111b2f;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#6b7280;
      --primary:#2563eb;
      --primary2:#1e40af;
      --border:#e5e7eb;
      --okBg:#d1fae5;
      --okText:#065f46;
      --warnBg:#fef3c7;
      --warnText:#92400e;
      --errBg:#fee2e2;
      --errText:#991b1b;
    }

    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1000px 500px at 20% 10%, rgba(37,99,235,.28), transparent 60%),
                  radial-gradient(900px 600px at 90% 30%, rgba(16,185,129,.14), transparent 60%),
                  linear-gradient(135deg,var(--bg1),var(--bg2));
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    .card{
      width:min(520px, 92vw);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.35);
      border-radius:22px;
      box-shadow: 0 25px 70px rgba(0,0,0,.45);
      padding:26px 26px 22px;
    }

    .brandRow{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:14px;
      margin-bottom:18px;
    }

    .brandLogo{
      width:56px;
      height:56px;
      border-radius:16px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(37,99,235,.10);
      border:1px solid rgba(37,99,235,.18);
    }

    .brandText{
      line-height:1.05;
      display:flex;
      flex-direction:column;
      align-items:flex-start;
    }

    .brandText .top{
      font-weight:900;
      letter-spacing:.4px;
      font-size:26px;
      color:var(--text);
    }

    .brandText .sub{
      font-weight:800;
      font-size:18px;
      color:var(--primary);
      margin-top:2px;
    }

    .tagline{
      text-align:center;
      color:var(--muted);
      font-size:12.5px;
      margin-top:-8px;
      margin-bottom:18px;
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-bottom:12px;
    }

    label{
      font-size:12px;
      color:#374151;
      font-weight:700;
    }

    input{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.95);
      outline:none;
      font-size:14.5px;
      color:var(--text);
      transition:.15s;
    }

    input:focus{
      border-color: rgba(37,99,235,.55);
      box-shadow: 0 0 0 4px rgba(37,99,235,.12);
    }

    .btn{
      width:100%;
      padding:13px 14px;
      border:none;
      border-radius:14px;
      background: linear-gradient(180deg, var(--primary), var(--primary2));
      color:white;
      font-weight:900;
      font-size:15px;
      cursor:pointer;
      margin-top:6px;
    }

    .btn.secondary{
      background: linear-gradient(180deg, #0f172a, #0b1220);
      display:none;
      margin-top:10px;
    }

    .result{
      margin-top:14px;
      padding:14px 14px;
      border-radius:14px;
      font-size:14px;
    }

    .success{ background: var(--okBg); color: var(--okText); }
    .warning{ background: var(--warnBg); color: var(--warnText); }
    .error{ background: var(--errBg); color: var(--errText); }

    .score{
      margin-top:8px;
      font-weight:900;
      font-size:14px;
    }

    #qrTmp {
      position: fixed;
      left: -9999px;
      top: -9999px;
    }
  </style>
</head>

<body>
  <div class="card">

    <div class="brandRow">
      <div class="brandLogo">
        <svg id="mainLogo" width="44" height="44" viewBox="0 0 64 64">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#2563eb"/>
              <stop offset="1" stop-color="#1e40af"/>
            </linearGradient>
            <linearGradient id="g2" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0" stop-color="#60a5fa"/>
              <stop offset="1" stop-color="#3b82f6"/>
            </linearGradient>
          </defs>

          <path d="M32 6 C24 12 16 12 12 12 v18 c0 14 8 23 20 28 c12-5 20-14 20-28 V12 c-4 0-12 0-20-6z"
                fill="url(#g1)"/>
          <path d="M32 12 C25 17 18 17 16 17 v13 c0 11 6.5 18 16 22 c9.5-4 16-11 16-22 V17 c-2 0-9 0-16-5z"
                fill="url(#g2)"/>
          <path d="M22 32.5 l6 6 l14-16"
                fill="none"
                stroke="#22c55e"
                stroke-width="6"
                stroke-linecap="round"
                stroke-linejoin="round"/>
        </svg>
      </div>

      <div class="brandText">
        <div class="top">IBAN</div>
        <div class="sub">Shield</div>
      </div>
    </div>

    <div class="tagline">Verifica preventiva IBAN + intestatario prima del bonifico.</div>

    <div class="field">
      <label>IBAN</label>
      <input id="iban">
    </div>

    <div class="field">
      <label>Nome intestatario</label>
      <input id="nome">
    </div>

    <div class="field">
      <label>Importo (â‚¬)</label>
      <input id="importo" type="number">
    </div>

    <button class="btn" onclick="verifica()">Verifica Transazione</button>
    <div id="risultato"></div>
    <button id="pdfBtn" class="btn secondary" onclick="generaPDF()">ðŸ“„ Genera Certificato</button>

  </div>

  <div id="qrTmp"></div>

<script>
const validIBAN = "IT60X0542811101000000123456";
const validName = "mario rossi";
let lastData = null;

function normalize(str){
  return (str || "").toLowerCase().trim().replace(/\s+/g," ");
}

function verifica(){
  const iban = document.getElementById("iban").value.trim();
  const nome = document.getElementById("nome").value;
  const importo = parseFloat(document.getElementById("importo").value);

  const result = document.getElementById("risultato");
  const pdfBtn = document.getElementById("pdfBtn");

  if(iban !== validIBAN){
    result.innerHTML="âŒ IBAN non valido (demo).";
    result.className="result error";
    return;
  }

  if(normalize(nome) !== validName){
    result.innerHTML="âŒ Nome intestatario NON compatibile con IBAN (demo).";
    result.className="result error";
    return;
  }

  let score=95, livello="Basso";
  let cls="result success";

  if(importo>1000){
    score=82;
    livello="Medio";
    cls="result warning";
  }

  result.innerHTML="Shield Score: "+score+"/100";
  result.className=cls;

  lastData={iban,nome,importo,score,livello};
  pdfBtn.style.display="block";
}

function svgToPng(svgElement){
  return new Promise(resolve=>{
    const svgData = new XMLSerializer().serializeToString(svgElement);
    const canvas = document.createElement("canvas");
    canvas.width = 300;
    canvas.height = 300;
    const ctx = canvas.getContext("2d");

    const img = new Image();
    img.onload = function(){
      ctx.drawImage(img,0,0);
      resolve(canvas.toDataURL("image/png"));
    };
    img.src='data:image/svg+xml;base64,'+btoa(unescape(encodeURIComponent(svgData)));
  });
}

async function generaPDF(){
  if(!lastData) return;

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit:"mm", format:"a4" });

  const id="IS-"+Date.now();
  const now=new Date().toLocaleString("it-IT");

  doc.setFillColor(15,23,42);
  doc.rect(0,0,210,32,"F");

  // LOGO IDENTICO
  const logoSvg = document.getElementById("mainLogo");
  const logoImg = await svgToPng(logoSvg);
  doc.addImage(logoImg,"PNG",15,7,20,20);

  doc.setTextColor(255);
  doc.setFont("helvetica","bold");
  doc.setFontSize(18);
  doc.text("IBAN Shield",40,20);
  doc.setFontSize(10);
  doc.text("Verified & Protected",40,27);

  doc.setTextColor(0);
  doc.setFontSize(16);
  doc.text("Certificato Ufficiale di Verifica",18,52);

  doc.rect(18,60,174,62);

  doc.setFontSize(11);
  doc.text("ID Verifica: "+id,24,74);
  doc.text("Data: "+now,24,84);
  doc.text("IBAN: "+lastData.iban,24,94);
  doc.text("Intestatario: "+lastData.nome,24,104);
  doc.text("Importo: â‚¬ "+lastData.importo,24,114);

  doc.save("Certificato_IBAN_Shield.pdf");
}
</script>
</body>
</html>
